const api={hub:{},load:(key,settings={})=>{let _s=Object.assign({url:'',type:'GET',dataType:'json',async:true,data:{},headers:{},timeout:1000,before:()=>{},success:(result,status)=>{},error:(status,error)=>{},complete:(status)=>{}},settings);api.hub[key]=_s},getdata:(key,param={},success=null,error=null,before=null,complete=null)=>{if(undefined==api.hub[key]){console.error("not fount api key"+key)return}_s=api.hub[key]let xhr=new XMLHttpRequest();xhr.addEventListener('abort',e=>{console.info("请求被终止abort触发")});xhr.addEventListener('error',e=>{({}!=error)?error(xhr.status,e):_s.error(xhr.status,e)});xhr.addEventListener('load',e=>{const status=xhr.status;if((status>=200&&status<300)||status===304){let result;if(xhr.responseType==='text'){result=xhr.responseText}else if(xhr.responseType==='document'){result=xhr.responseXML}else{result=xhr.response}({}!=success)?success(result,status):_s.success(result,status)}else{_s.error(status,e)}});xhr.addEventListener('loadend',e=>{(null!=complete)?complete(xhr.status):_s.complete(xhr.status)});xhr.addEventListener('loadstart',e=>{(null!=before)?before():_s.before()});xhr.addEventListener('parogress',e=>{console.log("数据调用中")});xhr.addEventListener('timeout',e=>{console.log("调用超时")});switch(_s.type.toUpperCase()){case'GET':case"DELETE":var suffix=((_s.url).indexOf('?')!==-1)?api._objectConverString(param):("?"+api._objectConverString(param))_s.url+=suffix _s.data=null break;case"POST":case"PUT":_s.data=api._buildHttpParam(param)break}xhr.open(_s.type,_s.url,_s.async);if(_s.async){xhr.responseType=_s.dataType}for(const key of Object.keys(_s.headers)){xhr.setRequestHeader(key,_s.headers[key])}if(_s.async&&_s.timeout){xhr.timeout=_s.timeout}xhr.send(_s.url,_s.data,false)},_buildHttpParam:(data)=>{result=null if(typeof data==="string"||data instanceof FormData){result=data}else if(true==data){result=api._objectConverString(data)}return result},_objectConverString:(data)=>{let arrResult=[];if(data instanceof Object){Object.keys(data).forEach(key=>{let val=data[key];if(val instanceof Date){val=dateFormat(val,'yyyy-MM-dd hh:mm:ss')}arrResult.push(encodeURIComponent(key)+'='+encodeURIComponent(val))})}return arrResult.join('&')}}